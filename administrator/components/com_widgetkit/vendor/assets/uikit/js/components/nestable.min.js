/*! UIkit 2.27.3 | http://www.getuikit.com | (c) 2014 YOOtheme | MIT License */
!function(t){var s;window.UIkit2&&(s=t(UIkit2)),"function"==typeof define&&define.amd&&define("uikit-nestable",["uikit"],function(){return s||t(UIkit2)})}(function(t){"use strict";var s,e="ontouchstart"in window,i=t.$html,l=[],a=t.$win,n=e?"touchstart":"mousedown",o=e?"touchmove":"mousemove",h=e?"touchend":"mouseup",r=e?"touchcancel":"mouseup";return t.component("nestable",{defaults:{listBaseClass:"uk-nestable",listClass:"uk-nestable-list",listItemClass:"uk-nestable-item",dragClass:"uk-nestable-dragged",movingClass:"uk-nestable-moving",noChildrenClass:"uk-nestable-nochildren",emptyClass:"uk-nestable-empty",handleClass:"",collapsedClass:"uk-collapsed",placeholderClass:"uk-nestable-placeholder",noDragClass:"uk-nestable-nodrag",group:!1,maxDepth:10,threshold:20,idlethreshold:10},boot:function(){t.$html.on("mousemove touchmove",function(e){if(s){var i=s.offset().top;i<t.$win.scrollTop()?t.$win.scrollTop(t.$win.scrollTop()-Math.ceil(s.height()/2)):i+s.height()>window.innerHeight+t.$win.scrollTop()&&t.$win.scrollTop(t.$win.scrollTop()+Math.ceil(s.height()/2))}}),t.ready(function(s){t.$("[data-uk-nestable]",s).each(function(){var s=t.$(this);s.data("nestable")||t.nestable(s,t.Utils.options(s.attr("data-uk-nestable")))})})},init:function(){var i=this;Object.keys(this.options).forEach(function(t){-1!=String(t).indexOf("Class")&&(i.options["_"+t]="."+i.options[t])}),this.find(this.options._listItemClass).find(">ul").addClass(this.options.listClass),this.checkEmptyList(),this.reset(),this.element.data("nestable-group",this.options.group||t.Utils.uid("nestable-group")),this.find(this.options._listItemClass).each(function(){i.setParent(t.$(this))}),this.on("click","[data-nestable-action]",function(s){if(!i.dragEl&&(e||0===s.button)){s.preventDefault();var l=t.$(s.currentTarget),a=l.data("nestableAction"),n=l.closest(i.options._listItemClass);"collapse"===a&&i.collapseItem(n),"expand"===a&&i.expandItem(n),"toggle"===a&&i.toggleItem(n)}});var l=function(s){var l=t.$(s.target),a=l.is("a[href]")?l:l.parents("a[href]");s.target!==i.element[0]&&(l.is(i.options._noDragClass)||l.closest(i.options._noDragClass).length||l.is("[data-nestable-action]")||l.closest("[data-nestable-action]").length||(i.options.handleClass&&!l.hasClass(i.options.handleClass)&&i.options.handleClass&&(l=l.closest(i.options._handleClass)),!l.length||i.dragEl||!e&&0!==s.button||e&&1!==s.touches.length||(s.originalEvent&&s.originalEvent.touches&&(s=evt.originalEvent.touches[0]),i.delayMove=function(t){a=!1,t.preventDefault(),i.dragStart(s),i.trigger("start.uk.nestable",[i]),i.delayMove=!1},i.delayMove.x=parseInt(s.pageX,10),i.delayMove.y=parseInt(s.pageY,10),i.delayMove.threshold=i.options.idlethreshold,a.length&&"touchend"==h&&i.one(h,function(){a&&a.attr("href").trim()&&(location.href=a.attr("href"))}),s.preventDefault())))},d=function(t){t.originalEvent&&t.originalEvent.touches&&(t=t.originalEvent.touches[0]),i.delayMove&&(Math.abs(t.pageX-i.delayMove.x)>i.delayMove.threshold||Math.abs(t.pageY-i.delayMove.y)>i.delayMove.threshold)&&(window.getSelection().toString()?i.delayMove=!1:i.delayMove(t)),i.dragEl&&(t.preventDefault(),i.dragMove(t),i.trigger("move.uk.nestable",[i]))},p=function(t){i.dragEl&&(t.preventDefault(),i.dragStop(e?t.touches[0]:t)),s=!1,i.delayMove=!1};e?(this.element[0].addEventListener(n,l,!1),window.addEventListener(o,d,!1),window.addEventListener(h,p,!1),window.addEventListener(r,p,!1)):(this.on(n,l),a.on(o,d),a.on(h,p))},serialize:function(){var s=this,e=function(i,l){var a=[];return i.children(s.options._listItemClass).each(function(){for(var i,n,o,h=t.$(this),r={},d=h.children(s.options._listClass),p=0;p<h[0].attributes.length;p++)i=h[0].attributes[p],0===i.name.indexOf("data-")&&(n=i.name.substr(5),o=t.Utils.str2json(i.value),r[n]=o||"false"==i.value||"0"==i.value?o:i.value);d.length&&(r.children=e(d,l+1)),a.push(r)}),a};return e(s.element,0)},list:function(s){var e=[],i=this,l=function(i,a,n){i.children(s._listItemClass).each(function(i){var o=t.$(this),h=t.$.extend({parent_id:n||null,depth:a,order:i},o.data()),r=o.children(s._listClass);e.push(h),r.length&&l(r,a+1,o.data(s.idProperty||"id"))})};return s=t.$.extend({},i.options,s),l(i.element,0),e},reset:function(){this.mouse={offsetX:0,offsetY:0,startX:0,startY:0,lastX:0,lastY:0,nowX:0,nowY:0,distX:0,distY:0,dirAx:0,dirX:0,dirY:0,lastDirX:0,lastDirY:0,distAxX:0,distAxY:0},this.moving=!1,this.dragEl=null,this.dragRootEl=null,this.dragDepth=0,this.hasNewRoot=!1,this.pointEl=null;for(var t=0;t<l.length;t++)this.checkEmptyList(l[t]);l=[]},toggleItem:function(t){this[t.hasClass(this.options.collapsedClass)?"expandItem":"collapseItem"](t)},expandItem:function(t){t.removeClass(this.options.collapsedClass)},collapseItem:function(t){t.children(this.options._listClass).length&&t.addClass(this.options.collapsedClass)},expandAll:function(){var s=this;this.find(s.options._listItemClass).each(function(){s.expandItem(t.$(this))})},collapseAll:function(){var s=this;this.find(s.options._listItemClass).each(function(){s.collapseItem(t.$(this))})},setParent:function(t){t.children(this.options._listClass).length&&t.addClass("uk-parent")},unsetParent:function(t){t.removeClass("uk-parent "+this.options.collapsedClass),t.children(this.options._listClass).remove()},dragStart:function(e){var l=this.mouse,a=t.$(e.target),n=a.closest(this.options._listItemClass),o=n.offset();this.placeEl=n,l.offsetX=e.pageX-o.left,l.offsetY=e.pageY-o.top,l.startX=l.lastX=o.left,l.startY=l.lastY=o.top,this.dragRootEl=this.element,this.dragEl=t.$("<ul></ul>").addClass(this.options.listClass+" "+this.options.dragClass).append(n.clone()),this.dragEl.css("width",n.width()),this.placeEl.addClass(this.options.placeholderClass),s=this.dragEl,this.tmpDragOnSiblings=[n[0].previousSibling,n[0].nextSibling],t.$body.append(this.dragEl),this.dragEl.css({left:o.left,top:o.top});var h,r,d=this.dragEl.find(this.options._listItemClass);for(h=0;h<d.length;h++)(r=t.$(d[h]).parents(this.options._listClass+","+this.options._listBaseClass).length)>this.dragDepth&&(this.dragDepth=r);i.addClass(this.options.movingClass)},dragStop:function(s){var e=t.$(this.placeEl),l=this.placeEl.parents(this.options._listBaseClass+":first");this.placeEl.removeClass(this.options.placeholderClass),this.dragEl.remove(),this.element[0]!==l[0]?(l.trigger("change.uk.nestable",[l.data("nestable"),e,"added"]),this.element.trigger("change.uk.nestable",[this,e,"removed"])):this.element.trigger("change.uk.nestable",[this,e,"moved"]),this.trigger("stop.uk.nestable",[this,e]),this.reset(),i.removeClass(this.options.movingClass)},dragMove:function(s){var e,i,a,n,o=this.options,h=this.mouse,r=this.dragRootEl?this.dragRootEl.data("nestable").options.maxDepth:o.maxDepth;this.dragEl.css({left:s.pageX-h.offsetX,top:s.pageY-h.offsetY}),h.lastX=h.nowX,h.lastY=h.nowY,h.nowX=s.pageX,h.nowY=s.pageY,h.distX=h.nowX-h.lastX,h.distY=h.nowY-h.lastY,h.lastDirX=h.dirX,h.lastDirY=h.dirY,h.dirX=0===h.distX?0:h.distX>0?1:-1,h.dirY=0===h.distY?0:h.distY>0?1:-1;var d=Math.abs(h.distX)>Math.abs(h.distY)?1:0;if(!h.moving)return h.dirAx=d,void(h.moving=!0);if(h.dirAx!==d?(h.distAxX=0,h.distAxY=0):(h.distAxX+=Math.abs(h.distX),0!==h.dirX&&h.dirX!==h.lastDirX&&(h.distAxX=0),h.distAxY+=Math.abs(h.distY),0!==h.dirY&&h.dirY!==h.lastDirY&&(h.distAxY=0)),h.dirAx=d,h.dirAx&&h.distAxX>=o.threshold&&(h.distAxX=0,a=this.placeEl.prev("li"),h.distX>0&&a.length&&!a.hasClass(o.collapsedClass)&&!a.hasClass(o.noChildrenClass)&&(e=a.find(o._listClass).last(),this.placeEl.parents(o._listClass+","+o._listBaseClass).length+this.dragDepth<=r&&(e.length?(e=a.children(o._listClass).last(),e.append(this.placeEl)):(e=t.$("<ul/>").addClass(o.listClass),e.append(this.placeEl),a.append(e),this.setParent(a)))),h.distX<0&&(n=this.placeEl.next(o._listItemClass),!n.length))){var p=this.placeEl.closest([o._listBaseClass,o._listClass].join(",")),c=p.closest(o._listItemClass);c.length&&(c.after(this.placeEl),p.children().length||this.unsetParent(c))}var g=!1,u=s.pageX-(window.pageXOffset||document.scrollLeft||0),f=s.pageY-(window.pageYOffset||document.documentElement.scrollTop);if(this.pointEl=t.$(document.elementFromPoint(u,f)),o.handleClass&&this.pointEl.hasClass(o.handleClass))this.pointEl=this.pointEl.closest(o._listItemClass);else{var m=this.pointEl.closest(o._listItemClass);m.length&&(this.pointEl=m)}if(!this.placeEl.find(this.pointEl).length){if(this.pointEl.data("nestable")&&!this.pointEl.children().length)g=!0,this.checkEmptyList(this.pointEl);else if(!this.pointEl.length||!this.pointEl.hasClass(o.listItemClass))return;var C=this.element,v=this.pointEl.closest(this.options._listBaseClass),E=C[0]!=v[0];if(!h.dirAx||E||g){if(E&&o.group!==v.data("nestable-group"))return;if(l.push(C),this.dragDepth-1+this.pointEl.parents(o._listClass+","+o._listBaseClass).length>r)return;var b=s.pageY<this.pointEl.offset().top+this.pointEl.height()/2;i=this.placeEl.parent(),g?this.pointEl.append(this.placeEl):b?this.pointEl.before(this.placeEl):this.pointEl.after(this.placeEl),i.children().length||i.data("nestable")||this.unsetParent(i.parent()),this.checkEmptyList(this.dragRootEl),this.checkEmptyList(C),E&&(this.dragRootEl=v,this.hasNewRoot=this.element[0]!==this.dragRootEl[0])}}},checkEmptyList:function(s){s=s?t.$(s):this.element,this.options.emptyClass&&s[s.children().length?"removeClass":"addClass"](this.options.emptyClass)}}),t.nestable});